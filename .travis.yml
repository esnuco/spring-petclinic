language: java

jdk:
  - oraclejdk7
  - openjdk7
  - openjdk6

branches:
  except: webanalytics

env: 
  global: 
    secure: CPaQpXrUdqpKF5JoOYQOb0OsbIwTuBYEyKABbTqbfMpdupQptNhmtEFI2UWM+1QTLv9R7WweBHPF1N/LHPs9ylBEdffedLHbeDtac5q8XXS7Rw9Mr/eb02JrkAJNqVgwDAwb/1vHCwTbG8ma+CJ0uGn7QjAaVjo2GKRzlhVXvpc=

# Merge the current branch into master before we test
before_install:
- git config --global user.email "travis@example.net"
- git config --global user.name "travis"
- git checkout master
- git branch -v
- git merge $TRAVIS_BRANCH
- git branch -v
- git remote show origin
- echo $TRAVIS_COMMIT_MESSAGE

# Execute everything in the build lifecycle before the test build phase
# We do this to make the output under the actual script show only output related to the test build phase
install: /bin/true

before_script:
# Only execute everything before the test build phase
- mvn process-resources
- mvn compile

# Execute the test build phase
script: "mvn test"


# Merge branch to master or Deploy artifact to staging
after_success:
# Merge to master if not on branch master
- if [[ "$TRAVIS_BRANCH" != "master" ]]; then git push https://${GITHUB_TOKEN}:x-oauth-basic@github.com/${TRAVIS_REPO_SLUG}.git $TRAVIS_BRANCH:master; fi
# Only deploy when on master branch
- if [[ "$TRAVIS_BRANCH" == "master" ]]; then echo "Deploying master to staging."; fi
